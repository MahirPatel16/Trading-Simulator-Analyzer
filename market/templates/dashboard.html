{% extends 'BaseAfterLogin.html' %}
{%block title%}
Dashboard
{%endblock%}
{%block head%}
<link rel="stylesheet" href="../static/css/style_dashboard.css" />
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Passion+One&display=swap"> -->
{%endblock%}

{% block profile %} <a href="/user_details">{{ username }}</a> {% endblock %}

{% block logout %}<a href='/logout'> LOG OUT </a>{% endblock %}

{%block content%}

<div class="toppers-container">
    <div class="first item bg">
        <div class="top-gainer-container">
            <div class="topper-title">Top Gainers</div>
            {% for gainer in top_gainers %}
            <!-- <ul class="top-gainers-list"> -->
            <a href="https://www.nseindia.com/get-quotes/equity?symbol={{ gainer['symbol'] }}" class="list-elem-gainer" target="_blank">
                <div class="name">{{ gainer['symbol'] }}</div>
                <div class="address">
                    Percentage Change : {{ gainer['pChange'] }} %
                </div>
                <div class="address">
                    Change : Rs. {{gainer['change']}} , Last Price : {{gainer['lastPrice']}}
                </div>
            </a>
            <!-- </ul> -->
            {% endfor %}
        </div>

        <div class="top-loser-container">
            <div class="topper-title">Top Losers</div>
            {% for loser in top_losers|reverse %}
            <a href="https://www.nseindia.com/get-quotes/equity?symbol={{ loser['symbol'] }}" class="list-elem-loser" target="_blank">
                <div class="name">{{ loser['symbol'] }}</div>
                <div class="address">
                    Percentage Change : {{ loser['pChange'] }} %
                </div>
                <div class="address">
                    Change : Rs. {{loser['change']}} , Last Price : {{loser['lastPrice']}}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    <div class="second item">
        
        
        <div class="upper bg">
            <div class="graph-container">
                {{ graph_html|safe }}
            </div>
        </div>
        <div class="below bg">
            <div class="search-dashboard">
                <form action="/search" method="get">
                    <input type="text" id="search" name="q" placeholder="Search" />
                    <button type="submit">Search</button>
                </form>
            </div>
            <div class="outer-horizontal">
                <div class="stock-name">
                    STOCK_NAME goes here
                </div>
                <div class="series-symbol">
                    <div class="series">
                        Series : 
                    </div>
                    <div class="series">
                        Symbol : 
                    </div>
                </div>
            </div>
            <div class="outer-horizontal">
                <div class="lower-inside-container-left">
                    percentage change
                    value change
                </div>
                <div class="lower-inside-container-left">
                    current price
                </div>
                <div class="lower-inside-container-right">
                    <div class="right-ke-andar">
                        intraday
                    </div>
                    <div class="right-ke-andar">
                        <div class="highlow">
                            high
                        </div>
                        <div class="highlow">
                            low
                        </div>
                    </div>
                </div>
                <div class="lower-inside-container-right">
                    <div class="right-ke-andar">
                        52 weeks
                    </div>
                    <div class="right-ke-andar">
                        <div class="highlow">
                            high
                        </div>
                        <div class="highlow">
                            low
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="third item bg">
        <h2>Business News</h2>
        <ul id="news-list"></ul>
    </div>
</div>
<div></div>
<script>
    $(document).ready(function () {
        function fetchNews() {
            $.ajax({
                type: "GET",
                url: "/get_news",
                success: function (response) {
                    displayNews(response);
                },
            });
        }
        function displayNews(news) {
            var newsList = $("#news-list");
            newsList.empty();

            var maxHeadlines = 8;
            for (var i = 0; i < Math.min(news.length, maxHeadlines); i++) {
                var article = news[i];
                var listItem = $("<li>");
                listItem.html(
                    `<a href="${article.url}" target="_blank">${article.title}</a>`
                );
                newsList.append(listItem);
            }
        }
        fetchNews();
        { graph_html|safe }
    });
</script>




{%endblock%}